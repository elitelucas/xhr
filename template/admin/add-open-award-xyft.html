<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="statics/admin/css/pintuer.css">
    <link rel="stylesheet" href="statics/admin/css/admin.css">
    <link rel="stylesheet" href="statics/admin/jedate/skin/jedate.css">
    <script src="statics/admin/js/jquery.js"></script>
    <!-- <script src="statics/admin/js/jquery.min.js" type="text/javascript"></script> -->
    <script src="statics/admin/js/pintuer.js"></script>
    <script src="statics/admin/js/layer/2.1/layer.js"></script>
    <script type="text/javascript" src="statics/admin/jedate/jquery.jedate.min.js"></script>
    <style>
        #page {
            height: 60px;
            margin-top: 20px;
            text-align: center;
        }

        #page ul li {
            float: left;
            margin-right: 10px;
        }

        #page ul .current {
            background-color: #0099ff;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="panel admin-panel">
    <div class="panel-head" id="add"><strong><span class="icon-pencil-square-o"></span>{if empty($issue)}手动补单{else}手动开奖{/if}</strong></div>
    <div class="body-content">
        <form method="post" class="form-x" action="" id="form">
            <div class="form-group">
                <div class="label">

                </div>
                <div class="field">
                    {if empty($issue)}
                    <span style="color: #1b961b; font-size: 30px">开奖彩种:</span> <span style="color:hotpink; font-size: 30px">{$game}</span>
                    {else}
                    <span style="color: #1b961b; font-size: 30px">开奖期号:</span> <span style="color:hotpink; font-size: 30px">{$issue}</span>
                    {/if}

                </div>
            </div>

            <div class="form-group"  style="display: {if empty($issue)}block{else}none{/if}" >
                <div class="label">
                    <label>开奖期号：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="{$issue}" name="issue" id="issue"
                           data-validate="required:请输入开奖期号"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖时间：</label>
                </div>
                <div class="field">
                    <input type="text" class="input w50" value="" name="open_time" id="open_time"
                           data-validate="required:请输入开奖时间"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码A：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberA" id="numberA"
                           data-validate="required:请输入号码A"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码B：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberB" id="numberB"
                           data-validate="required:请输入号码B"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码C：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberC" id="numberC"
                           data-validate="required:请输入号码C"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码D：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberD" id="numberD"
                           data-validate="required:请输入号码D"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码E：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberE" id="numberE"
                           data-validate="required:请输入号码E"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码F：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberF" id="numberF"
                           data-validate="required:请输入号码F"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码G：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberG" id="numberG"
                           data-validate="required:请输入号码G"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码H：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberH" id="numberH"
                           data-validate="required:请输入号码H"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码I：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberI" id="numberI"
                           data-validate="required:请输入号码I"/>
                    <div class="tips"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">
                    <label>开奖号码J：</label>
                </div>
                <div class="field">
                    <input type="number" class="input w50" value="" name="numberJ" id="numberJ"
                           data-validate="required:请输入号码J"/>
                    <div class="tips"></div>
                </div>
            </div>
            
            <div class="form-group">
                <div class="label">
                    <label></label>
                </div>
                <div class="field">
                    <input type="hidden" name="lottery_type" value="{$lottery_type}"/>
                    <button class="button bg-main icon-check-square-o" type="button" id="btn_submit"> 提交</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript">
    var loading = "";//加载中......
    var type = 1;
    var issue,open_time;
    var number = new Array(10);
    //或者为这样的
    $("#open_time").jeDate({
        isinitVal:true,
        festival:true,
        ishmsVal:true,
        minDate: '2016-06-16 23:59:59',
        maxDate: $.nowDate(0),
        format:"YYYY-MM-DD hh:mm:ss",
        zIndex:3000,
    })
    $(function () {
        $("#btn_submit").click(function () {
            //合理校验
            if ($("#issue").val() == "") {
                layer.msg('开奖期号不能为空', {icon: 5, shade: [0.5, '#393D49']});
                return false;
            }
            if ($("#open_time").val() == "") {
                layer.msg('开奖时间不能为空', {icon: 5, shade: [0.5, '#393D49']});
                return false;
            }
            var arr = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J"];
            var reg = /^\d{1,2}$/;
            var switches = true;
            $.each(arr, function(index, value) {
                if ($("#number"+value).val() == "") {
                    layer.msg('开奖号码'+value+'不能为空', {icon: 5, shade: [0.5, '#393D49']});
                    switches = false;
                    return false;
                }
                if (!reg.test($("#number"+value).val())) {
                    layer.msg('开奖号码'+value+'请输入0-9的数字', {icon: 5, shade: [0.5, '#393D49']});
                    switches = false;
                    return false;
                }
                if(type ===2){
                    if ($("#number"+value).val() !== number[index]) {
                        layer.msg('开奖号码'+value+'两次输入的开奖号不一致', {icon: 5, shade: [0.5, '#393D49']});
                        switches = false;
                        return false;
                    }
                }
            });

            if(switches== false){
                return false;
            }
            
            if (type === 1) {
                issue = $("#issue").val();
                open_time = $("#open_time").val();
                $.each(arr, function(index, value) {
                    number[index] = $("#number"+value).val();
                    $("#number"+value).val("");
                });
                console.log(number);
                {if empty($issue)}
                $("#issue").val("");
                {/if}
                $("#open_time").val("");
                $("#btn_submit").text("再次确认");
                type = 2;
                return false;
            }
            //校验两次输入是否一致
            if (issue !== $("#issue").val()) {
                layer.msg('两次输入的开奖期号不一致', {icon: 5, shade: [0.5, '#393D49']});
                return false;
            }
            //校验两次输入是否一致
            if (open_time !== $("#open_time").val()) {
                layer.msg('两次输入的开奖时间不一致', {icon: 5, shade: [0.5, '#393D49']});
                return false;
            }

            var formData = new FormData($("#form")[0]);
            loading = layer.load(1);
            $.ajax({
                url: '?m=admin&c=openAward&a=dealOpendaWard',
                type: 'POST',
                data: formData,
                dataType: 'JSON',
                cache: false,
                processData: false,
                contentType: false
            }).done(function (result) {
                console.log(result);
                layer.close(loading);
                if (result.status === 0) {
                    layer.msg('提交成功！！！', {icon: 6, shade: [0.5, '#393D49']}, function () {
                        window.location.href = document.referrer;//返回上一页并刷新
                    });
                } else {
                    layer.msg(result.ret_msg, {icon: 5, shade: [0.5, '#393D49']});
                }
            }).fail(function (err) {
                layer.close(loading);
                layer.msg('网络异常！开奖需要时间，请到开奖列表检查结果！', {icon: 5, shade: [0.5, '#393D49']});
            });
        });
    });

</script>
</body>
</html>