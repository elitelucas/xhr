<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title></title>
    <link rel="stylesheet" href="statics/admin/css/datePicker.css">
    <!--  <link rel="stylesheet" href="statics/admin/css/pintuer.css"> -->
    <link rel="stylesheet" href="statics/admin/css/admin.css">
    <link rel="stylesheet" href="statics/admin/js/layer/2.1/skin/layer.css">
    <link rel="stylesheet" href="statics/admin/js/layer/2.1/skin/layer.ext.css">
    <script src="statics/admin/js/jquery.js"></script>
    <script src="statics/admin/js/layer/2.1/layer.js"></script>
    <script src="statics/admin/js/layer/2.1/extend/layer.ext.js"></script>
    <script src="statics/admin/js/pintuer.js"></script>

    <!-- template-begin+++ -->
    {template public-new-ui-header}
    <!-- template-end+++ -->
    <script src="statics/admin/js/jquery.date_input.pack.js"></script>
    <link rel="stylesheet" href="statics/admin/jedate/skin/jedate.css">
    <script type="text/javascript" src="statics/admin/jedate/jquery.jedate.min.js"></script>

    <style type='text/css'>

        #page {
            height: 60px;
            margin-top: 20px;
            text-align: center;
        }

        #page ul li {
            float: left;
            margin-right: 10px;
        }

        #page ul .current {
            background-color: #0099ff;
            text-align: center;
        }

        .cnt {
            padding: 4px 8px 4px 8px;
            border-radius: 20px;
            background-color: #4dcd70;
            color: #ffffff;
            display: block;;
            margin-top: 3px;
        }
        .search_tips {
            color: #FF3300;
            margin-top: 2px;
            margin-bottom: 2px;
        }
    </style>

</head>
<body style="margin: 15px;background-color: #f3f3f4;">
<div class="row">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title iboxWTitle">
                <h5>每日结算</h5>
            </div>
            <div class="ibox-content" style="width: 100%;">
                <div class="dataTables_wrapper form-inline" role="grid" style="width: 100%">
                    <table class="table table-striped table-bordered table-hover  dataTable" aria-describedby="editable_info">
                        <tbody id="list_tb">
                        <tr>
                            <td width="100px"><h3>今日统计</h3></td>
                            <td>
                                <h6>有效下注:</h6>
                                <span class="cnt"><?php echo $day_data['13']['cnt']-$day_data['14']['cnt'].' 笔 / '; echo  number_format($day_data['13']['money'] - $day_data['14']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>撤单:</h6>
                                <span class="cnt"><?php echo $day_data['14']['cnt'].' 笔 / '; echo  number_format($day_data['14']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>中奖:</h6>
                                <span class="cnt"><?php echo ($day_data['12']['cnt'] - $day_data['120']['cnt']).' 笔 / '; echo  number_format($day_data['12']['money'] - $day_data['120']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>返点:</h6>
                                <span class="cnt"><?php echo $day_data['19']['cnt']+$day_data['20']['cnt']+$day_data['21']['cnt'].' 笔 / '; echo  number_format($day_data['19']['money']+$day_data['20']['money']+$day_data['21']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>充值:</h6>
                                <span class="cnt"><?php echo $day_data['10']['cnt'].' 笔 / '; echo  number_format($day_data['10']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>提现:</h6>
                                <span class="cnt"><?php echo $day_data['11']['cnt'].' 笔 / '; echo  number_format($day_data['11']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>投注盈亏:</h6>
                                <?php $tz_profit = number_format($day_data['13']['money']-$day_data['14']['money']-$day_data['12']['money']+$day_data['120']['money'],2);?>
                                <span class="cnt">
                	{if $tz_profit < 0}<font style="color: #FF3300;">{$tz_profit}</font>{/if}
			       	{if $tz_profit > 0}<font style="color: #0099ff;">{$tz_profit}</font>{/if}
			       	{if $tz_profit == 0}{$tz_profit}{/if}
                                          元</span>
                            </td>
                            <!--<td {if $v['profit_team'] < 0} style="color: red"{/if}>{$v['profit_team']}</td>-->
                            <!--<td {if $v['profit_team'] < 0} style="color: red"{/if}>{$v['profit_team']}</td>-->
                        </tr>
                        <tr>
                            <td><h3>本月统计</h3></td>
                            <td>
                                <h6>有效下注:</h6>
                                <span class="cnt"><?php echo $month_data['13']['cnt']-$month_data['14']['cnt'].' 笔 / '; echo  number_format($month_data['13']['money']-$month_data['14']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>撤单:</h6>
                                <span class="cnt"><?php echo $month_data['14']['cnt'].' 笔 / '; echo  number_format($month_data['14']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>中奖:</h6>
                                <span class="cnt"><?php echo ($month_data['12']['cnt'] - $month_data['120']['cnt']).' 笔 / '; echo  number_format($month_data['12']['money'] - $month_data['120']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>返点:</h6>
                                <span class="cnt"><?php echo $month_data['19']['cnt']+$month_data['20']['cnt']+$month_data['21']['cnt'].' 笔 / '; echo  number_format($month_data['19']['money']+$month_data['20']['money']+$month_data['21']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>充值:</h6>
                                <span class="cnt"><?php echo $month_data['10']['cnt'].' 笔 / '; echo  number_format($month_data['10']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>提现:</h6>
                                <span class="cnt"><?php echo $month_data['11']['cnt'].' 笔 / '; echo  number_format($month_data['11']['money'],2).' 元';?></span>
                            </td>
                            <td>
                                <h6>投注盈亏:</h6>
                                <?php $tz_profit = number_format($month_data['13']['money']-$month_data['14']['money']-$month_data['12']['money']+$month_data['120']['money'],2);?>
                                <span class="cnt">
                	{if $tz_profit < 0}<font style="color: #FF3300;">{$tz_profit}</font>{/if}
			       	{if $tz_profit > 0}<font style="color: #0099ff;">{$tz_profit}</font>{/if}
			       	{if $tz_profit == 0}{$tz_profit}{/if} 元
                </span>
                            </td>
                            <!--<td {if $v['profit_team'] < 0} style="color: red"{/if}>{$v['profit_team']}</td>-->
                        </tr>
                        </tbody>

                    </table>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <span class="color-s2">* 注：本月统计数据为非实时数据，最后更新统计时间为 {$last_write_date}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title iboxWTitle">
                <h5>明细查询</h5>
            </div>
            <div class="ibox-content" style="width: 100%;">
                <div class="row">
                    <form method="post" id="form" class="form-inline">

                        <div class="col-sm-3">
                            <div class="input-group m-b">
                                <span class="input-group-addon">时间</span>
                                <input style="width: 48%" name="start_time" class="date_picker form-control" id="datePicker" value="{$_REQUEST['start_time']}" placeholder="开始时间" />
                                <span style="float: left">&nbsp;&nbsp;</span>
                                <input style="width: 48%" name="end_time" class="date_picker form-control" value="{$_REQUEST['end_time']}" placeholder="结束时间" />
                            </div>
                        </div>

                        <div class="col-sm-2">
                            <div class="input-group m-b"><span class="input-group-addon">快捷查询</span>
                                <select class="form-control" id='quick' name="quick">
                                    <option value="0" {if $quick == 0}selected{/if}>全部</option>
                                    <option value="1" {if $quick == 1}selected{/if}>今日</option>
                                    <option value="2" {if $quick == 2}selected{/if}>昨日</option>
                                    <option value="3" {if $quick == 3}selected{/if}>本周</option>
                                    <option value="4" {if $quick == 4}selected{/if}>本月</option>
                                    <option value="5" {if $quick == 5}selected{/if}>上月</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-sm-3">
                            <div class="input-group m-b">
                                <button type='button' id="search" class="btn btn-primary">搜索</button>
                                &nbsp;&nbsp;
                                <button type='button' class="btn btn-primary" onclick="javascript:location.href = '?m=admin&c=reporting&a=dailyReport'">重置</button>
                            </div>
                        </div>

                    </form>
                </div>
                <br />
                <div id="editable_wrapper" class="dataTables_wrapper form-inline" role="grid" style="width: 100%">
                    <table class="table table-striped table-bordered table-hover  dataTable" id="editable" aria-describedby="editable_info">
                        <thead>
                        <tr>
                            <th>序号</th>
                            <th>日期</th>
                            <th>投注人数</th>
                            <!--        <th>投注单数</th>-->
                            <th>投注额</th>
                            <th>返点</th>
                            <th>派奖</th>
                            <th>充值</th>
                            <th>提现</th>
                            <th>调整</th>
                            <th>活动</th>
                            <th>投注盈亏</th>
                        </tr>
                        </thead>
                        <tbody id="data_list"></tbody>

                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg); //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    }
    //时间插件
    $(function () {
        var start_time = $("input[name=start_time]").val();
        var end_time = $("input[name=end_time]").val();
        var page = 1;
        if(getUrlParam("page")){

            page = getUrlParam("page");
        }


        $('#search').click(function () {
             start_time = $("input[name=start_time]").val();
             end_time = $("input[name=end_time]").val();
             var quick = $("#quick").val();
//            if (start_time == "") {
//                layer.msg('起始时间不能为空!!!', {icon: 5, shade: [0.5, '#393D49']});
//                return false;
//            }
//            if (end_time == "") {
//                layer.msg('结束时间不能为空!!!', {icon: 5, shade: [0.5, '#393D49']});
//                return false;
//            }

            if (end_time < start_time) {
                layer.msg('起始时间不能大于结束时间!!!', {icon: 5, shade: [0.5, '#393D49']});
                return false;
            }
            
            var diff_days = (new Date(end_time).getTime() - new Date(start_time).getTime()) / (24 * 60 * 60 * 1000);
            if (diff_days > 31) {
                layer.msg('查询时间跨度不能大于31天!!!', {icon: 5, shade: [0.5, '#393D49']});
                return false;
            }
            
            var myDate = new Date();
            //获取当前年
            var year = myDate.getFullYear();
            //获取当前月
            var month = myDate.getMonth() + 1;
            //获取当前日
            var date = myDate.getDate();
            var now = year + '-' + p(month) + "-" + p(date);
            console.log(now);
            if (end_time > now) {
                layer.msg('结束时间不能大于今天日期!!!', {icon: 5, shade: [0.5, '#393D49']});
                return false;
            }

            $.ajax({
                type: "POST",
                url: "<?=url('admin','reporting','dailyReportList')?>",
                traditional: true,
                data: {'start_time': start_time, 'end_time': end_time, 'page': page,'quick':quick},
                beforeSend: function () {
                    //loading层
                    index = layer.load(0, {
                        shade: [0.1, '#fff'] //0.1透明度的白色背景
                    });
                },
                success: function (msg) {
                    console.log(msg);
                    $('#data_list').html(msg);
                },
                complete: function () {
                    layer.close(index);
                }
            });
        });
        if (start_time != "") {
            $('#search').click();
        }
        $(".date_picker").jeDate({
            //isinitVal:true,
            ishmsVal:true,
            format:"YYYY-MM-DD",
            zIndex:3000,
        });

    });

    /**
     *
     * 获取当前时间
     */
    function p(s) {
        return s < 10 ? '0' + s : s;
    }
</script>
</body>
</html>